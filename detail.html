<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡πà‡∏á - Action.in.th</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Prompt', 'sans-serif'] },
                    colors: {
                        brand: { 50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7', 900: '#0c4a6e' },
                        action: { 500: '#10b981', 600: '#059669', 700: '#047857' }
                    }
                }
            }
        }
    </script>
    <style>body{background-color:#f8fafc;}</style>
</head>
<body class="text-slate-800 font-sans antialiased flex flex-col min-h-screen">

    <nav class="bg-white/90 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <a href="index.html" class="flex items-center gap-3 font-bold text-xl text-slate-800">
                    <div class="w-10 h-10 bg-brand-600 rounded-xl flex items-center justify-center text-white shadow-md">A</div>
                    Action.in.th
                </a>
                <a href="index.html" class="text-slate-500 hover:text-brand-600 font-medium">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
            </div>
        </div>
    </nav>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-6xl">
        
        <div id="loading" class="text-center py-20 text-slate-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

        <div id="content" class="hidden grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-2 space-y-6">
                <div class="rounded-2xl overflow-hidden shadow-lg border border-slate-100 h-[300px] md:h-[400px] relative">
                    <img id="event-img" src="" class="w-full h-full object-cover">
                    <div class="absolute top-4 right-4 bg-white/90 backdrop-blur px-3 py-1 rounded-lg text-sm font-bold shadow text-brand-700">
                        Official Event üèÜ
                    </div>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <h1 id="event-title" class="text-2xl md:text-3xl font-bold text-slate-800 mb-4">Title</h1>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-slate-600 mb-6">
                        <div class="flex items-center gap-3 bg-slate-50 p-3 rounded-lg">
                            <span class="text-2xl">üìÖ</span>
                            <div>
                                <div class="font-bold text-slate-900">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏á‡∏≤‡∏ô</div>
                                <div id="event-date">-</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3 bg-slate-50 p-3 rounded-lg">
                            <span class="text-2xl">üìç</span>
                            <div>
                                <div class="font-bold text-slate-900">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</div>
                                <div id="event-loc">-</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3 bg-slate-50 p-3 rounded-lg">
                            <span class="text-2xl">üèÉ</span>
                            <div>
                                <div class="font-bold text-slate-900">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á</div>
                                <div id="event-dist">-</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-3 bg-slate-50 p-3 rounded-lg">
                            <span class="text-2xl">üí∞</span>
                            <div>
                                <div class="font-bold text-slate-900">‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£</div>
                                <div id="event-price">-</div>
                            </div>
                        </div>
                    </div>

                    <hr class="border-slate-100 my-6">
                    
                    <h3 class="font-bold text-lg mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h3>
                    <p class="text-slate-500 leading-relaxed">
                        ‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡πà‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏¢‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏ç‡πà! ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô ‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏¥‡πà‡∏á‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô 
                        (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á: ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å Database ‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
                    </p>
                </div>
            </div>

            <div class="lg:col-span-1">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-slate-100 sticky top-24">
                    <h2 class="text-xl font-bold mb-1 flex items-center gap-2">
                        <span>üìù</span> ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
                    </h2>
                    <p class="text-xs text-slate-400 mb-4">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</p>

                    <form onsubmit="handleRegister(event)" class="space-y-4">
                        <input type="hidden" id="reg-event-id">
                        <input type="hidden" id="reg-event-name">

                        <div>
                            <label class="label-text">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢/‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)</label>
                            <input type="text" id="reg-name" class="input-field" placeholder="‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏£‡∏±‡∏Å‡∏î‡∏µ" required>
                        </div>

                        <div>
                            <label class="label-text">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ô BIB (‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)</label>
                            <input type="text" id="reg-bib" class="input-field" placeholder="SOMCHAI" required>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="label-text">‡πÄ‡∏û‡∏®</label>
                                <select id="reg-gender" class="input-field">
                                    <option value="Male">‡∏ä‡∏≤‡∏¢ (Male)</option>
                                    <option value="Female">‡∏´‡∏ç‡∏¥‡∏á (Female)</option>
                                </select>
                            </div>
                            <div>
                                <label class="label-text">‡πÑ‡∏ã‡∏™‡πå‡πÄ‡∏™‡∏∑‡πâ‡∏≠</label>
                                <select id="reg-size" class="input-field">
                                    <option value="XS">XS (34")</option>
                                    <option value="S">S (36")</option>
                                    <option value="M">M (38")</option>
                                    <option value="L">L (40")</option>
                                    <option value="XL">XL (42")</option>
                                    <option value="2XL">2XL (44")</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="label-text">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á</label>
                                <select id="reg-distance" class="input-field">
                                    <option value="5K">5 KM</option>
                                    <option value="10K">10 KM</option>
                                    <option value="21K">21 KM</option>
                                </select>
                            </div>
                            <div>
                                <label class="label-text">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                <input type="tel" id="reg-phone" class="input-field" placeholder="08x-xxxxxxx" required>
                            </div>
                        </div>

                        <div>
                            <label class="label-text">‡∏≠‡∏µ‡πÄ‡∏°‡∏• (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£)</label>
                            <input type="email" id="reg-email" class="input-field" placeholder="example@email.com" required>
                        </div>

                        <button type="submit" class="w-full bg-action-500 hover:bg-action-600 text-white font-bold py-3 rounded-xl shadow-md transition transform hover:scale-[1.02] mt-4">
                            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-white border-t border-slate-200 py-8 text-center text-slate-500 text-sm mt-auto">
        &copy; 2026 Action.in.th
    </footer>

    <style>
        .label-text { display: block; font-size: 0.875rem; font-weight: 500; color: #334155; margin-bottom: 0.25rem; }
        .input-field { width: 100%; padding: 0.625rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; font-size: 0.875rem; outline: none; transition: border-color 0.2s; }
        .input-field:focus { border-color: #0ea5e9; box-shadow: 0 0 0 2px rgba(14, 165, 233, 0.1); }
    </style>

    <script src="js/data.js"></script>
    <script>
        // 1. ‡∏î‡∏∂‡∏á ID ‡∏à‡∏≤‡∏Å URL (‡πÄ‡∏ä‡πà‡∏ô detail.html?id=xxx)
        const urlParams = new URLSearchParams(window.location.search);
        const eventId = urlParams.get('id');

        async function init() {
            if (!eventId) {
                alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°');
                window.location.href = 'index.html';
                return;
            }

            try {
                // 2. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡πà‡∏á‡∏à‡∏≤‡∏Å API
                const res = await fetch(`${API_URL}/${eventId}`);
                if (!res.ok) throw new Error('Event not found');
                const event = await res.json();

                // 3. ‡πÄ‡∏≠‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÅ‡∏õ‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
                document.getElementById('event-img').src = event.image || 'https://via.placeholder.com/800x400';
                document.getElementById('event-title').innerText = event.title_th;
                document.getElementById('event-date').innerText = event.date;
                document.getElementById('event-loc').innerText = event.location_th;
                document.getElementById('event-dist').innerText = event.distance || 'N/A';
                document.getElementById('event-price').innerText = event.price || 'Free';

                // ‡πÅ‡∏≠‡∏ö‡∏¢‡∏±‡∏î ID ‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏™‡πà‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÑ‡∏ß‡πâ (User ‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô ‡πÅ‡∏ï‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á)
                document.getElementById('reg-event-id').value = event._id;
                document.getElementById('reg-event-name').value = event.title_th;

                // ‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('content').classList.remove('hidden');

            } catch (err) {
                console.error(err);
                document.getElementById('loading').innerHTML = `<span class="text-red-500">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ</span>`;
            }
        }

        // 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£
        async function handleRegister(e) {
            e.preventDefault();
            
            const formData = {
                eventId: document.getElementById('reg-event-id').value,
                eventName: document.getElementById('reg-event-name').value,
                fullName: document.getElementById('reg-name').value,
                bibName: document.getElementById('reg-bib').value,
                gender: document.getElementById('reg-gender').value,
                shirtSize: document.getElementById('reg-size').value,
                distance: document.getElementById('reg-distance').value,
                phone: document.getElementById('reg-phone').value,
                email: document.getElementById('reg-email').value,
                paymentStatus: 'pending'
            };

            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å..."
            const btn = e.target.querySelector('button');
            const originalText = btn.innerText;
            btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
            btn.disabled = true;

            try {
                // ‡∏¢‡∏¥‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Endpoint ‡πÉ‡∏´‡∏°‡πà /registrations (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà /events ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!)
                // URL ‡∏Ç‡∏≠‡∏á API ‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ñ‡∏∑‡∏≠ .../events ‡πÄ‡∏£‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô .../registrations
                // ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢: ‡∏ï‡∏±‡∏î‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ events ‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ï‡∏¥‡∏° registrations ‡πÅ‡∏ó‡∏ô
                const regApiUrl = API_URL.replace('/events', '/registrations');

                const res = await fetch(regApiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (res.ok) {
                    alert('üéâ ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°');
                    window.location.href = 'index.html'; // ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
                } else {
                    throw new Error('Save failed');
                }
            } catch (err) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
                btn.innerText = originalText;
                btn.disabled = false;
            }
        }

        init();
    </script>
</body>
</html>