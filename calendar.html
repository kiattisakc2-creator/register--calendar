<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡πà‡∏á - Action.in.th</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>body{font-family:'Prompt',sans-serif;}</style>
</head>
<body class="bg-slate-50 text-slate-800">

    <nav class="bg-white/90 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <a href="index.html" class="flex items-center gap-3 cursor-pointer">
                    <div class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-md">A</div>
                    <span class="font-bold text-xl text-slate-800">Action.in.th</span>
                </a>
                
                <div class="flex items-center space-x-3">
                    <a href="index.html" class="text-slate-500 hover:text-blue-600 px-3 py-2 text-sm font-medium">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
                    <a href="calendar.html" class="text-blue-600 bg-blue-50 px-3 py-2 text-sm font-medium rounded-lg">‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a>
                    <button onclick="openSubmitModal()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-full text-sm font-bold shadow-md transition ml-2">
                        + ‡∏ù‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="flex flex-col md:flex-row justify-between items-end mb-6">
            <div>
                <h1 class="text-3xl font-bold text-slate-900">‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡πà‡∏á üìÖ</h1>
                <p class="text-slate-500">‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡πà‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏≤‡∏á‡∏ö‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏±‡πà‡∏ß‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®</p>
            </div>
        </div>

        <div id="calendar-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="col-span-full text-center py-20 text-slate-400">
                ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Server...
            </div>
        </div>
    </div>

    <div id="submit-modal" class="fixed inset-0 z-[70] flex items-center justify-center hidden">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeSubmitModal()"></div>
        <div class="bg-white w-full max-w-md mx-4 rounded-2xl shadow-2xl z-20 p-6">
            <h2 class="text-xl font-bold mb-4">‡∏ù‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà üèÉ‚Äç‚ôÇÔ∏è</h2>
            <div class="space-y-3">
                <input type="text" id="new-title" class="w-full border p-2 rounded" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡πà‡∏á (‡πÄ‡∏ä‡πà‡∏ô Pattaya Run)">
                <input type="date" id="new-date" class="w-full border p-2 rounded">
                <select id="new-province" class="w-full border p-2 rounded">
                    <option value="Bangkok">Bangkok</option>
                    <option value="Chiang Mai">Chiang Mai</option>
                </select>
                <input type="text" id="new-submitter" class="w-full border p-2 rounded" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ù‡∏≤‡∏Å">
                
                <div class="flex gap-2 pt-2">
                    <button onclick="closeSubmitModal()" class="flex-1 py-2 bg-gray-100 rounded">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button onclick="handleFormSubmit()" class="flex-1 py-2 bg-green-500 text-white rounded font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script>
        // --- 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Backend ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á ---
        async function loadCalendarEvents() {
            const container = document.getElementById('calendar-container');
            
            try {
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API
                const response = await fetch(API_URL);
                let events = await response.json();

                // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏õ‡∏¥‡∏î (‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡∏´‡∏°‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡∏ä‡∏≠‡∏ö)
                // events = events.filter(e => e.status !== 'closed'); 

                if (events.length === 0) {
                    container.innerHTML = `<div class="col-span-full text-center py-20 text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡πà‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>`;
                    return;
                }

                container.innerHTML = events.map(e => `
                    <div class="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden hover:shadow-md transition">
                        <div class="h-40 bg-slate-200 relative">
                            <img src="https://source.unsplash.com/random/800x400/?running,marathon&sig=${e._id}" class="w-full h-full object-cover">
                            <div class="absolute top-2 right-2 px-2 py-1 bg-white/90 rounded text-xs font-bold text-slate-700">
                                ${e.status === 'open' ? 'üü¢ ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£' : 'üü° ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö'}
                            </div>
                        </div>
                        <div class="p-4">
                            <div class="text-sm font-bold text-blue-600 mb-1">üìÖ ${e.date}</div>
                            <h3 class="font-bold text-lg text-slate-800 mb-2">${e.title_th}</h3>
                            <div class="text-sm text-slate-500 flex items-center gap-1">
                                üìç ${e.location_th || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'} 
                                <span class="text-xs bg-slate-100 px-2 rounded ml-auto">‡πÇ‡∏î‡∏¢ ${e.submitter || '‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å'}</span>
                            </div>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error(error);
                container.innerHTML = `<div class="col-span-full text-center py-20 text-red-400">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</div>`;
            }
        }

        // --- 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Modal ---
        function openSubmitModal() { document.getElementById('submit-modal').classList.remove('hidden'); }
        function closeSubmitModal() { document.getElementById('submit-modal').classList.add('hidden'); }

        // --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Backend ---
        async function handleFormSubmit() {
            const title = document.getElementById('new-title').value;
            const date = document.getElementById('new-date').value;
            
            if(!title || !date) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà");

            const newEvent = {
                title_th: title,
                title_en: title,
                date: date,
                location_th: document.getElementById('new-province').value,
                submitter: document.getElementById('new-submitter').value,
                status: 'pending' // ‡∏ù‡∏≤‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô open ‡πÄ‡∏•‡∏¢‡∏Å‡πá‡πÑ‡∏î‡πâ)
            };

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newEvent)
                });

                if(res.ok) {
                    alert('‡∏ù‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!');
                    closeSubmitModal();
                    loadCalendarEvents(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                }
            } catch(e) {
                alert('Error connecting to server');
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö
        loadCalendarEvents();
    </script>
</body>
</html>